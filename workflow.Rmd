---
title: "iSSA_workflow"
author: "Julie W Turner"
date: "6/17/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Preparing an iSSA

### The data

There are several things that need to be done prior to actually doing an iSSA

Overarchingly:
1. Clean the GPS data
2. Prepare the layers and other covariate data

#### Clean the GPS data

Things that you need to check and clean if they are not met:
1. Make sure all observations (GPS points) are complete
 - if not, remove incomplete observations
2. Check if there are duplicated GPS points (two taken at the same time)
 - remove duplicate observations

#### Prepare covariate input data

It is critical that all of the layers you plan to use and GPS points are in the same coordinate reference system. This can take a long time to reproject layers, crop them, and anything else you need to do for everything to be in the same "world," but it is critical to do for the later steps of extracting covariates by step.

### Making tracks

Once the data is clean, we make the points into a track. If you have more than one individual in the dataset, do it by individual.

```{r amt}
require(amt)
tracks <- dat %>% make_track(long, lat, datetime, crs = sp::CRS("+init=epsg:4326"), id = id)
```

#### Check the sampling rate

Now we should check how the sampling rate looks due to the messiness of GPS relocations.

```{r sampling rate}
trk_sk %>% mutate(sr = lapply(data, summarize_sampling_rate)) %>%
  dplyr::select(id, sr) %>% unnest(cols = c(sr))
```

Data are messy. For iSSA, we need the GPS fixes to happen at regular intervals, so we likely need to resample the data.

```{r resample}
require(amt) # This needs to be checked and updated, I don't know what I'm doing
resample_tracks <- function(tracks, rate, tolerance) {
  t <- track_resample(tracks, rate = rate, tolerance = tolerance) %>%
    filter_min_n_burst()
}
```


### Steps

Now we have tracks, but a step selection analysis requires steps! So, at this point, I usually calculate the observed steps at the same time that I create the random steps.

#### Check the distribution of steps and turn angles
Now to make sure there aren't any weirdos in the steps.  Usually there are a lot of little steps and few big steps, but this is a good check to make sure any erroneous obsevations are removed. For instance, this would show if there are any steps that are not biologically possible. It also shows the distribution so you know if you should use a Gamma or exponential distribution for generating random steps. Most are Gamma, and that is the default in `amt`.

```{r sl/ta distributions}
#graph
```



```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
